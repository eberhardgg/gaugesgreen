---
import { SITE } from "../config";

export interface Props {
  title?: string;
  description?: string;
}

const {
  title = SITE.title,
  description = SITE.desc,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site).href;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
    <link rel="canonical" href={canonicalURL} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={new URL('/og.png', Astro.site).href} />
    <meta name="twitter:card" content="summary_large_image" />
    <script is:inline>
      (function() {
        const stored = localStorage.getItem('theme');
        const theme = stored || 'dark';
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
    <style is:global>
      :root {
        --bg: #faf9f7;
        --text: #1a1918;
        --text-secondary: #3d3a38;
        --dim: #6b6560;
        --accent: #8b3a3a;
        --accent-hover: #6d2d2d;
        --border: #e5e2df;
        --font-body: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-size-base: .875rem;
        --font-size-small: .8125rem;
        --max-width: 640px;
      }

      [data-theme="dark"] {
        --bg: #141413;
        --text: #e8e6e1;
        --text-secondary: #c5c3be;
        --dim: #8a8a8a;
        --accent: #d4a59a;
        --accent-hover: #e8c4bb;
        --border: #2e2d2b;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      html {
        font-size: 16px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        font-family: var(--font-body);
        font-size: var(--font-size-base);
        line-height: 1.65;
        letter-spacing: -0.01em;
        color: var(--text);
        background: var(--bg);
        transition: background 0.25s, color 0.25s;
      }

      .main-content {
        padding: 48px 24px;
        max-width: var(--max-width);
        margin: 0 auto;
      }

      a {
        color: var(--accent);
        text-decoration: underline;
        text-decoration-thickness: 1px;
        text-underline-offset: 2px;
      }

      a:hover { color: var(--accent-hover); }

      a:focus-visible, button:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      p { margin: 0 0 1.5em 0; }
      p:last-child { margin-bottom: 0; }

      /* Header */
      .header {
        margin-bottom: 30px;
        padding-bottom: 30px;
        border-bottom: 1px solid var(--border);
      }

      .header__inner {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .header__logo {
        font-size: 1.125rem;
        font-weight: 600;
        letter-spacing: -0.02em;
        color: var(--text);
        text-decoration: none;
      }

      .header__logo:hover { color: var(--accent); }

      .dark-toggle {
        background: none;
        border: none;
        color: var(--dim);
        cursor: pointer;
        font-size: var(--font-size-small);
        font-family: var(--font-body);
        padding: 0;
      }

      .dark-toggle:hover { color: var(--text); }

      #theme-label {
        display: inline-block;
        min-width: 2.5em;
        text-align: center;
      }

      .header__nav { font-size: var(--font-size-small); }

      .header__nav a {
        color: var(--dim);
        text-decoration: none;
      }

      .header__nav a:hover { color: var(--text); }
      .header__nav a.active { color: var(--accent); }

      .header__nav-sep {
        color: var(--dim);
        margin: 0 6px;
        opacity: 0.4;
      }

      /* Home */
      .home-intro { }

      .headshot {
        display: block;
        width: 160px;
        height: 160px;
        object-fit: cover;
        margin: 0 0 1.5em 0;
      }

      /* Footer */
      .footer {
        margin-top: 48px;
        padding-top: 24px;
        border-top: 1px solid var(--border);
        font-size: var(--font-size-small);
      }

      .footer a {
        color: var(--dim);
        text-decoration: none;
      }

      .footer a:hover { color: var(--text); }

      /* Typography Scale */
      h1 {
        font-size: 1.5rem;
        font-weight: 600;
        letter-spacing: -0.03em;
        margin-bottom: 0.75em;
      }

      h2 {
        font-size: 1.125rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 1em;
      }

      h3 {
        font-size: var(--font-size-base);
        font-weight: 600;
        letter-spacing: -0.01em;
        margin-bottom: 0.25em;
      }

      hr {
        border: none;
        border-top: 1px solid var(--border);
        margin: 2em 0;
      }

      /* Entries */
      .entry { margin-bottom: 1.5em; }
      .entry:last-child { margin-bottom: 0; }
      .entry__header { margin-bottom: 0.25em; }
      .entry__title { font-weight: 600; }
      .entry__meta { font-size: var(--font-size-small); color: var(--dim); margin-left: 0.75em; }
      .entry__subtitle { font-size: var(--font-size-small); color: var(--accent); margin-bottom: 0.5em; }
      .entry__body { color: var(--text-secondary); }
      .entry__stat { margin-top: 0.5em; }
      .entry__stat-value { font-weight: 600; }
      .entry__stat-label { font-size: var(--font-size-small); color: var(--dim); margin-left: 0.5em; }

      /* Data rows */
      .data-row { display: flex; margin-bottom: 0.5em; }
      .data-row--header { font-size: var(--font-size-small); color: var(--dim); margin-bottom: 1em; }
      .data-cell { width: 4em; text-align: right; color: var(--text-secondary); }
      .data-cell--label { flex: 1; text-align: left; }
      .data-cell--dim { font-size: var(--font-size-small); color: var(--dim); }

      /* Post links */
      .post-link { display: block; text-decoration: none; margin-bottom: 1.5em; }
      .post-link:hover .post-link__title { color: var(--accent); }
      .post-link__header { margin-bottom: 0.25em; }
      .post-link__title { font-size: 1.5rem; font-weight: 600; letter-spacing: -0.03em; color: var(--text); }
      .post-link__date { font-size: var(--font-size-small); color: var(--dim); font-style: italic; display: block; margin-top: 0.25em; }
      .post-link__desc { color: var(--text-secondary); }

      /* Prose */
      .prose p { margin-bottom: 1.5em; }
      .prose h2 {
        font-size: var(--font-size-base);
        font-weight: 600;
        text-transform: none;
        letter-spacing: -0.01em;
        margin-top: 2em;
        margin-bottom: 0.75em;
      }
      .prose ul, .prose ol { margin: 0 0 1.5em 1.5em; }
      .prose li { margin-bottom: 0.5em; color: var(--text-secondary); }
      .prose strong { font-weight: 600; }
      .prose code { font-size: 0.9em; background: var(--border); padding: 0.15em 0.35em; border-radius: 3px; }

      /* Utilities */
      .back-link { display: inline-block; font-size: var(--font-size-small); color: var(--dim); text-decoration: none; margin-bottom: 1.5em; }
      .back-link:hover { color: var(--text); }
      .intro { color: var(--text-secondary); margin-bottom: 1em; }
      .note { font-size: var(--font-size-small); color: var(--dim); font-style: italic; }

      /* Mobile */
      @media (max-width: 600px) {
        .main-content { padding: 2rem 1.5rem; }
        .header { margin-bottom: 1.5rem; padding-bottom: 1.5rem; }
        .header__inner { margin-bottom: 1rem; }
        .header__logo { font-size: 1rem; }
        .header__nav { font-size: var(--font-size-small); line-height: 1.8; }
        .header__nav-sep { margin: 0 4px; }
        .headshot { width: 120px; height: 120px; margin: 0 0 1em 0; }
        .footer { margin-top: 2.5rem; padding-top: 1.5rem; }
      }
    </style>
  </head>
  <body>
    <main class="main-content">
      <slot />
    </main>
    <script is:inline>
      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        const label = document.getElementById('theme-label');
        if (label) label.textContent = theme === 'dark' ? 'light' : 'dark';
      }

      document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('theme-toggle');
        const label = document.getElementById('theme-label');
        const current = document.documentElement.getAttribute('data-theme') || 'light';
        if (label) label.textContent = current === 'dark' ? 'light' : 'dark';

        toggle?.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme');
          setTheme(current === 'dark' ? 'light' : 'dark');
        });
      });
    </script>
  </body>
</html>
