---
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
---

<PageLayout title="Products" description="Tools and projects in development from Gauges Green">
  <Container>
    <div>
      <!-- Page title -->
      <section class="animate" style="margin-bottom: 64px;">
        <h1 class="text-xl font-medium text-black dark:text-white" data-i18n="products_title">Products</h1>
      </section>

      <!-- Teaser -->
      <section class="animate" style="margin-bottom: 64px;">
        <p data-i18n="products_subtitle">Building in private.</p>
      </section>

      <!-- Form -->
      <section class="animate">
        <form
          name="testflight"
          method="POST"
          data-netlify="true"
          netlify-honeypot="bot-field"
          action="/products?success=true"
          id="testflight-form"
          style="max-width: 320px;"
        >
          <input type="hidden" name="form-name" value="testflight" />
          <p class="hidden" aria-hidden="true"><input name="bot-field" tabindex="-1" /></p>

          <div style="margin-bottom: 24px;">
            <label for="email" class="block font-medium text-black dark:text-white" style="margin-bottom: 8px;" data-i18n="products_email_label">
              Email
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              autocomplete="email"
              placeholder="you@company.com"
              aria-describedby="email-hint"
              class="w-full bg-transparent border border-neutral-200 dark:border-neutral-800 rounded focus:border-neutral-400 dark:focus:border-neutral-600 focus:outline-none transition-colors"
              style="padding: 12px 16px;"
            />
            <p id="email-hint" class="sr-only">We'll use this to send TestFlight invites</p>
          </div>

          <button
            type="submit"
            class="text-black dark:text-white hover:opacity-60 transition-opacity"
          >
            <span data-i18n="products_cta">Request TestFlight access</span>
            <span class="text-neutral-400 dark:text-neutral-500" style="margin-left: 8px;" aria-hidden="true">â†’</span>
          </button>
        </form>

        <!-- Success state -->
        <div id="success-message" class="hidden">
          <p class="font-medium text-black dark:text-white" style="margin-bottom: 8px;">Thanks.</p>
          <p>We'll be in touch.</p>
        </div>
      </section>
    </div>
  </Container>
</PageLayout>

<script>
  const form = document.getElementById('testflight-form') as HTMLFormElement | null;
  const successMessage = document.getElementById('success-message');
  const urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('success') === 'true') {
    if (form) form.classList.add('hidden');
    if (successMessage) {
      successMessage.classList.remove('hidden');
      successMessage.setAttribute('role', 'status');
      successMessage.setAttribute('aria-live', 'polite');
    }
  }

  form?.addEventListener('submit', (e) => {
    const emailInput = form.querySelector('input[type="email"]') as HTMLInputElement;
    if (!emailInput.validity.valid) {
      e.preventDefault();
      emailInput.focus();
    }
  });
</script>
