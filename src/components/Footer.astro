---
import Container from "@components/Container.astro";
---

<footer class="py-16">
  <Container>
    <div class="text-sm space-y-4">
      <div class="opacity-40">
        <button
          id="theme-toggle"
          class="hover:opacity-100 transition-opacity"
          aria-label="Toggle dark mode"
        >
          <span id="theme-label">dark</span>
        </button>
        <span class="mx-2" aria-hidden="true">Â·</span>
        <button
          id="lang-toggle"
          class="hover:opacity-100 transition-opacity"
          aria-label="Toggle language"
        >
          <span id="lang-label">es</span>
        </button>
      </div>
      <div class="opacity-30 text-xs">
        &copy; {new Date().getFullYear()} Gauges Green
      </div>
    </div>
  </Container>
</footer>

<script>
  // Theme toggle
  const themeToggle = document.getElementById('theme-toggle');
  const themeLabel = document.getElementById('theme-label');

  function setTheme(dark: boolean) {
    if (dark) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
      if (themeLabel) themeLabel.textContent = 'light';
      themeToggle?.setAttribute('aria-pressed', 'true');
    } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
      if (themeLabel) themeLabel.textContent = 'dark';
      themeToggle?.setAttribute('aria-pressed', 'false');
    }
  }

  themeToggle?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    setTheme(!isDark);
  });

  // Keyboard: Enter or Space to toggle
  themeToggle?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      themeToggle.click();
    }
  });

  // Initialize theme
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
  setTheme(isDark);

  // Language toggle
  const langToggle = document.getElementById('lang-toggle');
  const langLabel = document.getElementById('lang-label');

  function setLang(lang: string) {
    localStorage.setItem('lang', lang);
    if (langLabel) langLabel.textContent = lang === 'en' ? 'es' : 'en';

    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (key && (window as any).translations?.[lang]?.[key]) {
        el.textContent = (window as any).translations[lang][key];
      }
    });

    document.querySelectorAll('[data-i18n-html]').forEach(el => {
      const key = el.getAttribute('data-i18n-html');
      if (key && (window as any).translations?.[lang]?.[key]) {
        el.innerHTML = (window as any).translations[lang][key];
      }
    });
  }

  langToggle?.addEventListener('click', () => {
    const current = localStorage.getItem('lang') || 'en';
    setLang(current === 'en' ? 'es' : 'en');
  });

  // Keyboard: Enter or Space to toggle
  langToggle?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      langToggle.click();
    }
  });

  // Initialize language
  const savedLang = localStorage.getItem('lang') || 'en';
  setLang(savedLang);
</script>
