---
import { Moon, Sun } from "lucide-astro";
---

<button
    id="theme-btn"
    class="focus-outline rounded-full p-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
    title="Toggles light & dark"
    aria-label="auto"
    aria-live="polite"
>
    <Moon id="moon-svg" class="w-6 h-6" />
    <Sun id="sun-svg" class="hidden w-6 h-6" />
</button>

<script is:inline>
    const themeBtn = document.querySelector("#theme-btn");
    const sunIcon = document.querySelector("#sun-svg");
    const moonIcon = document.querySelector("#moon-svg");

    const theme = (() => {
        if (
            typeof localStorage !== "undefined" &&
            localStorage.getItem("theme")
        ) {
            return localStorage.getItem("theme");
        }
        return "light";
    })();

    if (theme === "light") {
        document.documentElement.classList.remove("dark");
        sunIcon.classList.add("hidden");
        moonIcon.classList.remove("hidden");
    } else {
        document.documentElement.classList.add("dark");
        sunIcon.classList.remove("hidden");
        moonIcon.classList.add("hidden");
    }

    window.localStorage.setItem("theme", theme);

    const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("dark");

        const isDark = element.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");

        if (isDark) {
            sunIcon.classList.remove("hidden");
            moonIcon.classList.add("hidden");
        } else {
            sunIcon.classList.add("hidden");
            moonIcon.classList.remove("hidden");
        }
    };

    themeBtn.addEventListener("click", handleToggleClick);
</script>
